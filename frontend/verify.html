<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ | Black Dynasty</title>
    <link rel="icon" type="image/png" href="https://scontent.fsof10-1.fna.fbcdn.net/v/t39.30808-6/571988370_841740614988641_4931287812958960179_n.jpg?stp=dst-jpg_p526x296_tt6&_nc_cat=104&ccb=1-7&_nc_sid=127cfc&_nc_ohc=vPi-CTI7HzgQ7kNvwFOs44m&_nc_oc=AdmhhkDEScpULrOL7FMpuYDkorP2fQ7TjfkW-5LlppSpNCeu_7qgfJrJS6hrdp3EnZw&_nc_zt=23&_nc_ht=scontent.fsof10-1.fna&_nc_gid=OYzJmC24oCiwhmrzameNZQ&oh=00_AfeG9S_Zez74r_X57lFPEdqVuf--As4jZ6X028IqaLRKZg&oe=6909AE5E">
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="https://scontent.fsof10-1.fna.fbcdn.net/v/t39.30808-6/571988370_841740614988641_4931287812958960179_n.jpg?stp=dst-jpg_p526x296_tt6&_nc_cat=104&ccb=1-7&_nc_sid=127cfc&_nc_ohc=vPi-CTI7HzgQ7kNvwFOs44m&_nc_oc=AdmhhkDEScpULrOL7FMpuYDkorP2fQ7TjfkW-5LlppSpNCeu_7qgfJrJS6hrdp3EnZw&_nc_zt=23&_nc_ht=scontent.fsof10-1.fna&_nc_gid=OYzJmC24oCiwhmrzameNZQ&oh=00_AfeG9S_Zez74r_X57lFPEdqVuf--As4jZ6X028IqaLRKZg&oe=6909AE5E" alt="Black Dynasty Logo" class="logo">
                <h1>Black Dynasty Forum</h1>
            </div>
            <nav>
                <a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="login.html" class="nav-link">–í–æ–π—Ç–∏</a>
                <a href="register.html" class="nav-link">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </nav>
        </div>
    </header>

    <main>
        <div class="verify-container card">
            <div id="verification-content">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div id="status-icon" style="width: 80px; height: 80px; background: linear-gradient(135deg, #6366f1, #4f46e5); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 2rem;">‚è≥</div>
                    <h2 id="status-title">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞...</h2>
                    <p id="status-message" style="color: #cbd5e1; font-size: 1.125rem; margin-bottom: 2rem;">
                        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞—à —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.
                    </p>
                </div>
                
                <div id="action-buttons" class="buttons" style="display: none;">
                    <a href="login.html" class="btn">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</a>
                    <a href="index.html" class="btn btn-secondary">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                </div>
                
                <div id="resend-section" style="display: none; text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <p style="color: #cbd5e1; margin-bottom: 1rem;">–ù–µ –ø–æ–ª—É—á–∏–ª–∏ –ø–∏—Å—å–º–æ?</p>
                    <form id="resend-form">
                        <input type="email" id="resend-email" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email" required style="margin-bottom: 1rem;">
                        <button type="submit" class="btn btn-secondary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
                    </form>
                    <div style="margin-top:1rem; color:#cbd5e1; font-size:0.9rem;">
                        –ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å? <a href="reset.html" class="nav-link" style="color:#6366f1;">–°–±—Ä–æ—Å–∏—Ç—å</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="js/config.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            const statusIcon = document.getElementById('status-icon');
            const statusTitle = document.getElementById('status-title');
            const statusMessage = document.getElementById('status-message');
            const actionButtons = document.getElementById('action-buttons');
            const resendSection = document.getElementById('resend-section');
            
            if (!token) {
                // –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
                statusIcon.innerHTML = 'üìß';
                statusIcon.style.background = 'linear-gradient(135deg, #f59e0b, #10b981)';
                statusTitle.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email';
                statusMessage.innerHTML = '–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –ø–∏—Å—å–º–∞ –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤–æ–µ –ø–∏—Å—å–º–æ.';
                resendSection.style.display = 'block';
            } else {
                // –ï—Å—Ç—å —Ç–æ–∫–µ–Ω - –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ–≥–æ
                try {
                    const response = await fetch(api(`/api/auth/verify/${token}`), {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok && result.success) {
                        // –£—Å–ø–µ—à–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
                        statusIcon.innerHTML = '‚úì';
                        statusIcon.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        statusTitle.textContent = '–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!';
                        statusMessage.innerHTML = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∏ –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—Å–µ–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ —Ñ–æ—Ä—É–º–∞.';
                        actionButtons.style.display = 'flex';
                    } else {
                        // –û—à–∏–±–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
                        statusIcon.innerHTML = '‚ùå';
                        statusIcon.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                        statusTitle.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
                        statusMessage.innerHTML = result.message || '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π –∏–ª–∏ –∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.';
                        resendSection.style.display = 'block';
                    }
                } catch (error) {
                    // –û—à–∏–±–∫–∞ —Å–µ—Ç–∏
                    statusIcon.innerHTML = '‚ö†Ô∏è';
                    statusIcon.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                    statusTitle.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
                    statusMessage.innerHTML = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                    resendSection.style.display = 'block';
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
            const resendForm = document.getElementById('resend-form');
            if (resendForm) {
                resendForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const email = document.getElementById('resend-email').value;
                    const submitButton = resendForm.querySelector('button[type="submit"]');
                    const originalText = submitButton.innerHTML;
                    
                    submitButton.innerHTML = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
                    submitButton.disabled = true;
                    
                    try {
                        const response = await fetch(api('/api/auth/resend-verification'), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ email })
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok && result.success) {
                            statusMessage.innerHTML = '‚úÖ Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –ø–æ—á—Ç—É.';
                            resendForm.style.display = 'none';
                        } else {
                            statusMessage.innerHTML = `‚ùå ${result.message || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email'}`;
                        }
                    } catch (error) {
                        statusMessage.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É';
                    } finally {
                        submitButton.innerHTML = originalText;
                        submitButton.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>
